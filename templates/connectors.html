{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <h2 class="mb-4">Cloud Connectors</h2>

    <!-- GCP Connection Status -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Google Cloud Platform</h5>
            {% if gcp_connected %}
            <span class="badge bg-success">Connected</span>
            {% else %}
            <span class="badge bg-secondary">Not Connected</span>
            {% endif %}
        </div>
        <div class="card-body">
            {% if gcp_connected %}
            <div class="mb-3">
                <p><strong>Project:</strong> {{ gcp_project_id }}</p>
                <p><strong>Connected as:</strong> {{ gcp_email }}</p>
            </div>
            <form action="{{ url_for('disconnect_gcp') }}" method="post" class="d-inline">
                <button type="submit" class="btn btn-outline-danger">Disconnect</button>
            </form>
            {% else %}
            <p class="mb-3">Connect your Google Cloud Platform account to manage IAM permissions and resources.</p>
            <a href="{{ url_for('authorize_gcp') }}" class="btn btn-primary">
                Connect GCP Account
            </a>
            {% endif %}
        </div>
    </div>

    <!-- Neo4j Connection -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">Neo4j Database</h5>
            {% if neo4j_connected %}
            <span class="badge bg-success">Connected</span>
            {% else %}
            <span class="badge bg-secondary">Not Connected</span>
            {% endif %}
        </div>
        <div class="card-body">
            <form action="{{ url_for('update_neo4j_connection') }}" method="post">
                <div class="mb-3">
                    <label for="neo4j_uri" class="form-label">Neo4j URI</label>
                    <input type="text" class="form-control" id="neo4j_uri" name="neo4j_uri" 
                           value="{{ neo4j_uri }}" placeholder="bolt://localhost:7687">
                </div>
                <div class="mb-3">
                    <label for="neo4j_user" class="form-label">Username</label>
                    <input type="text" class="form-control" id="neo4j_user" name="neo4j_user" 
                           value="{{ neo4j_user }}">
                </div>
                <div class="mb-3">
                    <label for="neo4j_password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="neo4j_password" name="neo4j_password">
                </div>
                <button type="submit" class="btn btn-primary">Update Connection</button>
            </form>
        </div>
    </div>

    {% if gcp_connected and neo4j_connected %}
    <!-- Graph Visualization -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">IAM Graph Visualization</h5>
        </div>
        <div class="card-body">
            <div id="graph-container" style="height: 600px;">
                <!-- Graph will be rendered here -->
            </div>
        </div>
    </div>
    {% endif %}
</div>

<!-- Include Vis.js for graph visualization -->
{% if gcp_connected and neo4j_connected %}
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script src="{{ url_for('static', filename='js/graph.js') }}"></script>
{% endif %}
{% endblock %}
